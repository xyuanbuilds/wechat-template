<!--pages/player-test/player-test.wxml-->
<view class="container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="header">
    <text class="title">ğŸµ éŸ³é¢‘æ’­æ”¾å™¨æµ‹è¯•</text>
    <text class="subtitle">ç¯å¢ƒ: {{playerInfo.isWeChat ? 'å¾®ä¿¡å°ç¨‹åº' : 'H5/Web'}}</text>
  </view>

  <!-- æ’­æ”¾å™¨æ§åˆ¶åŒºåŸŸ -->
  <view class="player-section">
    <view class="section-title">
      <text class="title-text">æ’­æ”¾æ§åˆ¶</text>
    </view>
    
    <!-- å½“å‰æ’­æ”¾ä¿¡æ¯ -->
    <view class="current-info">
      <view class="info-row">
        <text class="label">å½“å‰éŸ³é¢‘:</text>
        <text class="value">{{playerState.src ? testAudios[currentAudioIndex].title : 'æœªé€‰æ‹©'}}</text>
      </view>
      <view class="info-row">
        <text class="label">æ’­æ”¾çŠ¶æ€:</text>
        <text class="value status {{playerState.playing ? 'playing' : (playerState.paused ? 'paused' : 'stopped')}}">
          {{playerState.playing ? 'â–¶ï¸ æ’­æ”¾ä¸­' : (playerState.paused ? 'â¸ï¸ å·²æš‚åœ' : 'â¹ï¸ å·²åœæ­¢')}}
        </text>
      </view>
      <view class="info-row">
        <text class="label">æ’­æ”¾æ—¶é—´:</text>
        <text class="value">{{utils.formatTime(playerState.currentTime)}} / {{utils.formatTime(playerState.duration)}}</text>
      </view>
      <view class="info-row" wx:if="{{playerState.loading}}">
        <text class="label">çŠ¶æ€:</text>
        <text class="value loading">â³ åŠ è½½ä¸­...</text>
      </view>
    </view>

    <!-- æ’­æ”¾è¿›åº¦æ¡ -->
    <view class="progress-section">
      <text class="progress-label">æ’­æ”¾è¿›åº¦: {{progress}}%</text>
      <slider 
        class="progress-slider"
        value="{{progress}}"
        min="0"
        max="100"
        block-size="16"
        backgroundColor="#e9ecef"
        activeColor="#007aff"
        bindchange="onProgressChange"
      />
    </view>

    <!-- éŸ³é‡æ§åˆ¶ -->
    <view class="volume-section">
      <text class="volume-label">ğŸ”Š éŸ³é‡: {{volume}}%</text>
      <slider 
        class="volume-slider"
        value="{{volume}}"
        min="0"
        max="100"
        block-size="16"
        backgroundColor="#e9ecef"
        activeColor="#34c759"
        bindchange="onVolumeChange"
      />
    </view>

    <!-- æ’­æ”¾æ§åˆ¶æŒ‰é’® -->
    <view class="control-buttons">
      <button class="control-btn secondary" bindtap="playPrevious">â®ï¸ ä¸Šä¸€é¦–</button>
      <button 
        class="control-btn primary {{playerState.loading ? 'loading' : ''}}" 
        bindtap="togglePlay"
        disabled="{{playerState.loading}}"
      >
        {{playerState.playing ? 'â¸ï¸ æš‚åœ' : 'â–¶ï¸ æ’­æ”¾'}}
      </button>
      <button class="control-btn secondary" bindtap="playNext">â­ï¸ ä¸‹ä¸€é¦–</button>
    </view>

    <view class="control-buttons">
      <button class="control-btn danger" bindtap="stopPlay">â¹ï¸ åœæ­¢</button>
      <button class="control-btn info" bindtap="getPlayerState">ğŸ“Š çŠ¶æ€</button>
    </view>
  </view>

  <!-- æµ‹è¯•éŸ³é¢‘åˆ—è¡¨ -->
  <view class="audio-list-section">
    <view class="section-title">
      <text class="title-text">æµ‹è¯•éŸ³é¢‘åˆ—è¡¨</text>
    </view>
    
    <view class="audio-list">
      <view 
        class="audio-item {{currentAudioIndex === index ? 'active' : ''}}"
        wx:for="{{testAudios}}"
        wx:key="id"
        data-index="{{index}}"
        bindtap="playAudio"
      >
        <view class="audio-info">
          <text class="audio-title">{{item.title}}</text>
          <text class="audio-duration">{{item.duration}}</text>
        </view>
        <view class="audio-status">
          <text wx:if="{{currentAudioIndex === index && playerState.playing}}">ğŸµ</text>
          <text wx:elif="{{currentAudioIndex === index && playerState.paused}}">â¸ï¸</text>
          <text wx:else>â–¶ï¸</text>
        </view>
      </view>
    </view>
  </view>

  <!-- è‡ªå®šä¹‰éŸ³é¢‘æµ‹è¯• -->
  <view class="custom-section">
    <view class="section-title">
      <text class="title-text">è‡ªå®šä¹‰éŸ³é¢‘æµ‹è¯•</text>
    </view>
    
    <view class="custom-input">
      <input 
        class="url-input"
        placeholder="è¯·è¾“å…¥éŸ³é¢‘ URL"
        value="{{customUrl}}"
        bindinput="onCustomUrlInput"
      />
      <button class="play-custom-btn" bindtap="playCustomUrl">æ’­æ”¾</button>
    </view>
  </view>

  <!-- åŠŸèƒ½æµ‹è¯•æŒ‰é’® -->
  <view class="function-section">
    <view class="section-title">
      <text class="title-text">åŠŸèƒ½æµ‹è¯•</text>
    </view>
    
    <view class="function-buttons">
      <button class="function-btn" bindtap="preloadTest">ğŸ“‚ é¢„åŠ è½½æµ‹è¯•</button>
      <button class="function-btn" bindtap="clearCache">ğŸ—‘ï¸ æ¸…ç†ç¼“å­˜</button>
    </view>
  </view>

  <!-- äº‹ä»¶æ—¥å¿— -->
  <view class="log-section">
    <view class="section-title">
      <text class="title-text">äº‹ä»¶æ—¥å¿—</text>
      <view class="log-actions">
        <button class="log-btn" bindtap="clearLogs">æ¸…ç©º</button>
        <button class="log-btn" bindtap="copyLogs">å¤åˆ¶</button>
      </view>
    </view>
    
    <scroll-view class="log-container" scroll-y="true">
      <view class="log-item" wx:for="{{eventLogs}}" wx:key="*this">
        <text class="log-text">{{item}}</text>
      </view>
      <view class="log-empty" wx:if="{{eventLogs.length === 0}}">
        <text>æš‚æ— æ—¥å¿—</text>
      </view>
    </scroll-view>
  </view>
</view>

<!-- è‡ªå®šä¹‰æ–¹æ³•æ¨¡æ¿ -->
<wxs module="utils">
  var formatTime = function(seconds) {
    if (!seconds || seconds < 0) return '00:00';
    
    var mins = Math.floor(seconds / 60);
    var secs = Math.floor(seconds % 60);
    
    var minsStr = mins < 10 ? '0' + mins : mins.toString();
    var secsStr = secs < 10 ? '0' + secs : secs.toString();
    
    return minsStr + ':' + secsStr;
  };
  
  module.exports = {
    formatTime: formatTime
  };
</wxs>

<!-- ä½¿ç”¨ WXS æ ¼å¼åŒ–æ—¶é—´ -->
<template name="formatTime">
  <text>{{utils.formatTime(time)}}</text>
</template>