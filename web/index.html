<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Antd Mobile UMD ç»„ä»¶åŠ è½½å™¨</title>
    <!-- React UMD é“¾æ¥ -->
    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.development.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
    ></script>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 2rem;
        line-height: 1.6;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: white;
      }
      .container {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        padding: 2rem;
        border-radius: 20px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      }
      h1 {
        text-align: center;
        margin-bottom: 2rem;
        font-size: 2.5rem;
      }
      .feature {
        background: rgba(255, 255, 255, 0.1);
        padding: 1rem;
        margin: 1rem 0;
        border-radius: 10px;
        border-left: 4px solid #fff;
      }
      .btn {
        display: inline-block;
        background: rgba(255, 255, 255, 0.2);
        color: white;
        padding: 12px 24px;
        text-decoration: none;
        border-radius: 25px;
        transition: all 0.3s ease;
        border: 2px solid rgba(255, 255, 255, 0.3);
        cursor: pointer;
        font-size: 16px;
        margin: 5px;
      }
      .btn:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: translateY(-2px);
      }
      .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none !important;
      }
      /* React ç»„ä»¶æ ·å¼ */
      .react-component {
        background: rgba(255, 255, 255, 0.15);
        padding: 1.5rem;
        margin: 1rem 0;
        border-radius: 15px;
        border: 2px solid rgba(255, 255, 255, 0.2);
      }
      /* Antd Mobile æ ·å¼æ”¯æŒ */
      .adm-button {
        font-family: inherit !important;
      }
      .footer {
        text-align: center;
        margin-top: 2rem;
        opacity: 0.8;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ“± Antd Mobile UMD åŠ è½½å™¨</h1>

      <div class="feature">
        <h3>âš›ï¸ Antd Mobile ç»„ä»¶æ¼”ç¤º</h3>
        <p>ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®æ¥åŠ è½½ antd-mobile UMD ç»„ä»¶åº“å¹¶æ¸²æŸ“ Button ç»„ä»¶ï¼š</p>

        <div style="text-align: center; margin: 1rem 0">
          <button id="load-antd-mobile" class="btn">
            ğŸ“± åŠ è½½ Antd Mobile Button
          </button>
        </div>
      </div>

      <div class="footer">
        <p>éƒ¨ç½²æ—¶é—´: <span id="timestamp"></span></p>
      </div>
    </div>

    <!-- Antd Mobile UMD ç»„ä»¶åŠ è½½å™¨ -->
    <script>
      // ç»„ä»¶åŠ è½½å™¨ç±»
      class CardLoader {
        // åŠ è½½å¤–éƒ¨ UMD ç»„ä»¶
        static loadComponent(url, componentName) {
          return new Promise((resolve, reject) => {
            // æ£€æŸ¥ç»„ä»¶æ˜¯å¦å·²å­˜åœ¨
            if (window[componentName]) {
              console.log(`âš¡ ${componentName} å·²å­˜åœ¨ï¼Œè·³è¿‡åŠ è½½`);
              resolve(window[componentName]);
              return;
            }

            const script = document.createElement("script");
            script.src = url;
            script.onload = () => {
              console.log(`âœ… ${componentName} åŠ è½½æˆåŠŸ`);
              const Component = window[componentName];
              if (Component) {
                resolve(Component);
              } else {
                reject(new Error(`ç»„ä»¶ ${componentName} æœªæ‰¾åˆ°`));
              }
            };
            script.onerror = () => {
              reject(new Error(`åŠ è½½å¤±è´¥: ${url}`));
            };
            document.head.appendChild(script);
          });
        }

        // è‡ªåŠ¨åˆ›å»ºå®¹å™¨å¹¶æ¸²æŸ“ç»„ä»¶
        static renderComponent(Component, options = {}) {
          const {
            requestId,
            title = "ğŸ“± Antd Mobile ç»„ä»¶",
            props = {},
          } = options;

          const containerId = requestId || `antd-container-${Date.now()}`;

          // æŸ¥æ‰¾çˆ¶å®¹å™¨
          const parent = document.querySelector(".container");
          if (!parent) {
            throw new Error("çˆ¶å®¹å™¨æœªæ‰¾åˆ°");
          }

          // åˆ›å»ºç»„ä»¶åŒ…è£…å™¨
          const wrapper = document.createElement("div");
          wrapper.className = "feature";

          const titleElement = document.createElement("h4");
          titleElement.textContent = title;
          wrapper.appendChild(titleElement);

          // åˆ›å»ºç»„ä»¶å®¹å™¨
          const container = document.createElement("div");
          container.id = containerId;
          container.className = "react-component";

          wrapper.appendChild(container);
          parent.appendChild(wrapper);

          // æ¸²æŸ“ç»„ä»¶
          const root = ReactDOM.createRoot(container);
          root.render(React.createElement(Component, props));

          console.log(`ğŸš€ ç»„ä»¶å·²æ¸²æŸ“åˆ° #${containerId}`);

          return { root, container, wrapper };
        }

        // ä¸€æ­¥åŠ è½½å¹¶æ¸²æŸ“
        static loadAndRender(url, componentName, options = {}) {
          return this.loadComponent(url, componentName).then((Component) => {
            return this.renderComponent(Component, options);
          });
        }
      }

      // é¡µé¢åŠ è½½å®Œæˆåè®¾ç½®
      window.addEventListener("DOMContentLoaded", function () {
        // æ˜¾ç¤ºå½“å‰æ—¶é—´
        document.getElementById("timestamp").textContent =
          new Date().toLocaleString("zh-CN");

        // Antd Mobile åŠ è½½æŒ‰é’®äº‹ä»¶
        document
          .getElementById("load-antd-mobile")
          .addEventListener("click", function () {
            // é˜²æ­¢é‡å¤ç‚¹å‡»
            this.disabled = true;
            this.textContent = "ğŸ”„ æ­£åœ¨åŠ è½½...";

            CardLoader.loadComponent(
              "https://unpkg.com/antd-mobile@5.39.0/umd/antd-mobile.js",
              "antdMobile"
            )
              .then((antdMobile) => {
                console.log("âœ… Antd Mobile åŠ è½½æˆåŠŸ:", antdMobile);

                // åˆ›å»º Antd Mobile Button æ¼”ç¤ºç»„ä»¶
                const AntdButtonDemo = function (props) {
                  const [count, setCount] = React.useState(0);

                  // TODO å®é™…çš„å¡ç‰‡ç›´æ¥åŠ è½½
                  const { Button } = antdMobile;

                  return React.createElement(
                    "div",
                    {
                      style: { textAlign: "center", padding: "20px" },
                    },
                    React.createElement(
                      "p",
                      {
                        style: { margin: "15px 0", fontSize: "16px" },
                      },
                      `è®¡æ•°: ${count}`
                    ),

                    React.createElement(
                      "div",
                      { style: { margin: "20px 0" } },
                      React.createElement(
                        Button,
                        {
                          color: "primary",
                          size: "large",
                          onClick: () => setCount(count + 1),
                          style: { margin: "8px" },
                        },
                        "ğŸ”¥ å¢åŠ "
                      ),

                      React.createElement(
                        Button,
                        {
                          color: "default",
                          onClick: () => setCount(count - 1),
                          style: { margin: "8px" },
                        },
                        "ğŸ“‰ å‡å°‘"
                      )
                    ),

                    React.createElement(
                      "div",
                      { style: { margin: "20px 0" } },
                      React.createElement(
                        Button,
                        {
                          color: "success",
                          fill: "outline",
                          onClick: () => setCount(0),
                          style: { margin: "8px" },
                        },
                        "ğŸ”„ é‡ç½®"
                      ),

                      React.createElement(
                        Button,
                        {
                          color: "warning",
                          fill: "none",
                          disabled: count < 0,
                          style: { margin: "8px" },
                        },
                        count < 0 ? "âŒ å·²ç¦ç”¨" : "âš ï¸ è­¦å‘Š"
                      )
                    ),

                    React.createElement(
                      "p",
                      {
                        style: {
                          fontSize: "14px",
                          opacity: 0.7,
                          marginTop: "15px",
                        },
                      },
                      "âœ¨ çœŸæ­£çš„ Antd Mobile æŒ‰é’®ç»„ä»¶"
                    )
                  );
                };

                // æ¸²æŸ“ç»„ä»¶
                const result = CardLoader.renderComponent(AntdButtonDemo, {
                  title: "ğŸ“± Antd Mobile Button ç»„ä»¶",
                });

                console.log("ğŸ¯ Antd Mobile Button å·²æ¸²æŸ“:", result);
                alert("Antd Mobile Button ç»„ä»¶åŠ è½½æˆåŠŸï¼\nå‘ä¸‹æ»šåŠ¨æŸ¥çœ‹æ•ˆæœã€‚");

                // æ»šåŠ¨åˆ°æ–°ç»„ä»¶
                setTimeout(() => {
                  result.wrapper.scrollIntoView({ behavior: "smooth" });
                }, 100);

                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                this.disabled = false;
                this.textContent = "âœ… å·²åŠ è½½ Antd Mobile";
              })
              .catch((error) => {
                console.error("Antd Mobile åŠ è½½å¤±è´¥:", error);
                alert("åŠ è½½å¤±è´¥: " + error.message);

                // æ¢å¤æŒ‰é’®çŠ¶æ€
                this.disabled = false;
                this.textContent = "âŒ åŠ è½½å¤±è´¥ï¼Œé‡è¯•";
              });
          });
      });

      // ä½¿ç”¨ç¤ºä¾‹
      /*
        // åŠ è½½ Antd Mobile ç»„ä»¶åº“
        CardLoader.loadComponent(
            'https://unpkg.com/antd-mobile@5.39.0/umd/antd-mobile.js',
            'antdMobile'
        ).then(antdMobile => {
            const { Button, Card, Input } = antdMobile;
            
            const MyComponent = function() {
                return React.createElement('div', null,
                    React.createElement(Button, { color: 'primary' }, 'æˆ‘çš„æŒ‰é’®')
                );
            };
            
            CardLoader.renderComponent(MyComponent, {
                title: 'ğŸ“± æˆ‘çš„ Antd Mobile ç»„ä»¶'
            });
        });

        // ä¸€æ­¥åŠ è½½å¹¶æ¸²æŸ“
        CardLoader.loadAndRender(
            'https://unpkg.com/antd-mobile@5.39.0/umd/antd-mobile.js',
            'antdMobile',
            {
                title: 'ğŸ“± å¿«é€ŸåŠ è½½çš„ç»„ä»¶',
                props: { message: 'Hello World' }
            }
        );
        */
    </script>
  </body>
</html>
